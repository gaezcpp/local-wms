<odoo>

  <!-- ===================== SEARCH VIEW ===================== -->
  <record id="view_tagging_record_search" model="ir.ui.view">
    <field name="name">tagging.record.search</field>
    <field name="model">tagging.record</field>
    <field name="arch" type="xml">
      <search string="Search Tagging">
        <field name="name"/>
        <field name="plant_code"/>
        <field name="business_unit_code"/>
        <field name="work_center"/>
        <field name="functional_location"/>
        <field name="problem_category"/>
        <field name="status"/>

        <separator/>

        <!-- Open = open + open_wo -->
        <filter string="Open" name="flt_open"
                domain="['|',('status','=','open'),('status','=','open_wo')]"/>
        <filter string="Validated" name="flt_validated"
                domain="[('status','=','validated')]"/>
        <filter string="Postponed" name="flt_postponed"
                domain="[('status','=','postponed')]"/>
        <filter string="Closed" name="flt_closed"
                domain="[('status','=','closed')]"/>

        <separator/>

        <filter string="Group by Status" name="grp_status" context="{'group_by': 'status'}"/>
        <filter string="Group by Plant" name="grp_plant" context="{'group_by': 'plant_code'}"/>
        <filter string="Group by Work Center" name="grp_wc" context="{'group_by': 'work_center'}"/>
      </search>
    </field>
  </record>

  <!-- ===================== LIST VIEW ===================== -->
  <record id="view_tagging_record_list" model="ir.ui.view">
    <field name="name">tagging.record.list</field>
    <field name="model">tagging.record</field>
    <field name="arch" type="xml">
      <list string="Tagging List" default_order="create_date desc">
        <field name="create_date" string="Tanggal"/>

        <field name="status" widget="badge"
               decoration-danger="status == 'open'"
               decoration-warning="status in ('validated','open_wo','postponed')"
               decoration-success="status == 'closed'"/>

        <field name="name" string="Ticket"/>
        <field name="plant_code" string="Plant"/>
        <field name="business_unit_code" string="Business Area"/>
        <field name="work_center" string="Work Center"/>
        <field name="functional_location" string="Functional Location"/>

        <field name="pic_name" string="PIC"/>
        <field name="problem_category" string="Kategori Masalah"/>
        <field name="equipment" string="Equipment (Snapshot)"/>
        <field name="sku" string="SKU (Snapshot)"/>
      </list>
    </field>
  </record>

  <!-- ===================== FORM VIEW ===================== -->
  <record id="view_tagging_record_form" model="ir.ui.view">
    <field name="name">tagging.record.form</field>
    <field name="model">tagging.record</field>
    <field name="arch" type="xml">
      <form string="Tagging">

        <header>
          <field name="status" widget="statusbar"
                 statusbar_visible="open,validated,open_wo,postponed,closed"/>

          <!-- OPEN -->
          <button name="action_validate" type="object" string="Validate"
                  class="btn-primary"
                  invisible="status != 'open'"/>

          <button name="action_open_reject_wizard" type="object" string="Reject"
                  class="btn-secondary"
                  invisible="status != 'open'"/>

          <!-- VALIDATED -->
          <button name="action_set_wo" type="object" string="Set Work Order"
                  class="btn-secondary"
                  invisible="status != 'validated'"/>

          <!-- CLOSE: boleh ditutup dari validated / open_wo -->
          <button name="action_set_closed" type="object" string="Set Closed"
                  class="btn-primary"
                  invisible="status not in ('validated','open_wo')"/>
        </header>

        <!-- LOCK ALL CONTENT WHEN CLOSED -->
        <sheet readonly="status == 'closed'">

          <div class="oe_title">
            <h1><field name="name" readonly="1"/></h1>
          </div>

          <group>
            <group string="Tagging Info">
              <field name="tagger_name"/>
              <field name="barcode_id" readonly="1"/>
              <field name="pic_id"/>
              <field name="pic_name" readonly="1"/>
              <field name="status" readonly="1"/>
            </group>

            <group string="Location Snapshot">
              <field name="plant_code" readonly="1"/>
              <field name="plant_name" readonly="1"/>
              <field name="business_unit_code" readonly="1"/>
              <field name="business_unit_name" readonly="1"/>
              <field name="work_center" readonly="1"/>
              <field name="functional_location" readonly="1"/>
            </group>
          </group>

          <group string="Category Problem">
            <!-- master reference -->
            <field name="category_problem_id"/>
            <!-- stored string -->
            <field name="problem_category" readonly="1"/>
          </group>

          <group string="Close - Equipment Master"
                 invisible="status not in ('validated','open_wo','closed')">
            <!-- wajib dipilih sebelum close (di action_set_closed kamu udah validate) -->
            <field name="machine_bom_id"
                   options="{'no_create': True, 'no_create_edit': True}"/>
          </group>

          <group string="Snapshot (After Close)">
            <group>
              <field name="equipment" readonly="1"/>
              <field name="spare_part" readonly="1"/>
            </group>
            <group>
              <field name="sku" readonly="1"/>
            </group>
          </group>

          <notebook>
            <page string="Description">
              <field name="description"/>
            </page>

            <page string="Photos">
              <field name="attachment_ids" widget="many2many_binary"/>
            </page>

            <page string="Reject Reason" invisible="not reject_reason">
              <field name="reject_reason" readonly="1" nolabel="1"/>
            </page>
          </notebook>

        </sheet>
      </form>
    </field>
  </record>

  <!-- ===================== GRAPH VIEW ===================== -->
  <record id="view_tagging_record_graph" model="ir.ui.view">
    <field name="name">tagging.record.graph</field>
    <field name="model">tagging.record</field>
    <field name="arch" type="xml">
      <graph string="Tagging Statistics" type="bar">
        <field name="status" type="row"/>
        <field name="id" type="measure"/>
      </graph>
    </field>
  </record>

  <!-- ===================== REJECT WIZARD VIEW ===================== -->
  <record id="view_tagging_reject_wizard_form" model="ir.ui.view">
    <field name="name">tagging.record.reject.wizard.form</field>
    <field name="model">tagging.record.reject.wizard</field>
    <field name="arch" type="xml">
      <form string="Reject Tagging">
        <group>
          <field name="record_id" invisible="1"/>
          <field name="reason" placeholder="Tuliskan alasan reject..." />
        </group>
        <footer>
          <button name="action_confirm_reject" type="object" string="Reject" class="btn-primary"/>
          <button string="Cancel" special="cancel" class="btn-secondary"/>
        </footer>
      </form>
    </field>
  </record>

  <!-- ===================== ACTION ===================== -->
  <record id="action_tagging_records" model="ir.actions.act_window">
    <field name="name">Tagging List</field>
    <field name="res_model">tagging.record</field>
    <field name="view_mode">list,form,graph</field>
    <field name="view_id" ref="view_tagging_record_list"/>
    <field name="search_view_id" ref="view_tagging_record_search"/>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">Buat data tagging pertama.</p>
    </field>
  </record>

  <!-- ===================== MENUS ===================== -->
  <!-- kalau menu_tagging_root sudah ada di file lain, HAPUS 2 baris ini -->
  <menuitem id="menu_tagging_root" name="Tagging System" sequence="5"/>
  <menuitem id="menu_tagging_list" name="Tagging" parent="menu_tagging_root"
            action="action_tagging_records" sequence="40"/>

</odoo>
